---
layout: post
title: CS:APP3e-lab02 Bomb Lab 解题报告
tags:
- Assembly
- Operating system
categories: CSAPP
---

最近因为参加比赛有两周没有做lab了，上周昨晚了bomb lab，现在终于想起来补这篇解题报告，这次实验是一次相当有趣的拆炸弹游戏（嗯，没错，你可以理解为游戏），要利用gdb进行反汇编调试，一步步找到通过六个关卡和一个隐藏关的密码。总体涉及C语言的分支跳转循环链表二叉树等结构的汇编语言表示，总的说来并不算特别难。

## Bomb Lab 简介

Github地址：[Bomb Lab](https://github.com/zxc479773533/CS-APP3e-labs/tree/master/bomblab)

这个lab练习反汇编调试程序，需要你对汇编语言有一些掌握，最起码需要明白每个指令是要干什么。整个实验基础部分有六关，每一关有个密码，你需要在调试的过程中通过逆向工程解析出通关的密码，以此来突破六关，此外还有一个隐藏关，需要你去找到它的入口并解析出它的密码。当然如果你输入了错误的密码，炸弹就会爆炸。

首先让我们来看一看实验中给出的`boom.c`文件。

```c
/* Hmm...  Six phases must be more secure than one phase! */
    input = read_line();             /* Get input                   */
    phase_1(input);                  /* Run the phase               */
    phase_defused();                 /* Drat!  They figured it out!
				      * Let me know how they did it. */
    printf("Phase 1 defused. How about the next one?\n");
```

这一部分显然就是每一关的代码，`input`是我们输入的密码字符串，`puase_x`就是每一关的判断函数，在通过这一关之后会调用`phase_defused`函数，然后打印一行提示信息。

整个文件并没有什么太多的提示，唯一要我们注意的地方就是在第六关结束之后，有这样一段话：

```c
/* Wow, they got it!  But isn't something... missing?  Perhaps
     * something they overlooked?  Mua ha ha ha ha! */
```

有什么忽略的地方？对，那就是本实验还有一个隐藏关卡，至于怎么进入就需要我们自己去探讨了。

## GDB调试器

关于汇编语言的细节我就不再赘述了，很多地方都有指令含义的介绍。我们这里重点提一下我们解决本lab的工具——gdb调试器。

首先，我们可以先对整个文件进行反汇编处理一下：

```shell
objdump -d bomb > bomb.asm //得到含有整个程序所有汇编代码的文件
objdump -t bomb > func.asm //得到含有整个程序所有函数入口地址的文件
```

接着，使用`gdb bomb`进入gdb调试界面。先介绍下常用的命令：

* r：运行程序
* b *0x400e65：在地址为0x400e65处设置断点
* d 1：删除第一个断点，以此类推
* c：继续运行
* stepi：执行一条指令
* stepi 2：执行两条指令，以此类推
* disas：反汇编当前函数
* disas 0x400e65：反汇编0x400e65为入口地址的函数
* disas main：反汇编以main为函数名的函数
* info frame：查看有关栈帧的信息
* info registers：查看有关寄存器的信息
* p $rax：查看寄存器%rax内储存的值
* x $rax：查看以寄存器%rax内储存的值为地址处的值
* p或x /s $rax：以字符串形式输出
* p或x /t $rax：以二进制形式输出
* p或x /x $rax：以十六进制形式输出
* x /32b $rsp：查看栈帧的前32字节
* x /8g $rax：查看以$rax中储存的值位地址开始的8个字

好了，常用的命令就这么些，接下来就让我们开始紧张刺激的拆炸弹游戏了！

## 第一关：简单的字符串

## 第二关：等比数列

## 第三关：switch

## 第四关：递归

## 第五关：映射

## 第六关：链表

## 寻找隐藏关

## 隐藏关：二叉树